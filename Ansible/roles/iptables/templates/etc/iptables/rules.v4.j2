# Generated by ansible
*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p icmp -j ACCEPT

{% for input_chain in INPUT_CHAINS %}
:{{ input_chain.name }} {{ input_chain.policy }} [0:0]
-A INPUT -j {{ input_chain.name }}
{% for input_chain_rule in input_chain.rules %}
-A {{ input_chain.name }} {{ input_chain_rule }} 
{% endfor %}
-A {{ input_chain.name }} -j RETURN
{% endfor %}
-A INPUT -j DROP

-A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -p icmp -j ACCEPT
-A OUTPUT -p tcp -m tcp --dport 53 -j ACCEPT
-A OUTPUT -p udp -m udp --dport 53 -j ACCEPT

{% for output_chain in OUTPUT_CHAINS %}
:{{ output_chain.name }} {{ output_chain.policy }} [0:0]
-A OUTPUT -j {{ output_chain.name }}
{% for output_chain_rule in output_chain.rules %}
-A {{ output_chain.name }} {{ output_chain_rule }}
{% endfor %}
-A {{ output_chain.name }} -j RETURN
{% endfor %}
-A OUTPUT -j DROP

{% for forward_chain in FORWARD_CHAINS %}
:{{ forward_chain.name }} {{ forward_chain.policy }} [0:0]
-A FORWARD -j {{ forward_chain.name }}
{% for forward_chain_rule in forward_chain.rules %}
-A {{ forward_chain.name }} {{ forward_chain_rule }}
{% endfor %}
-A {{ forward_chain.name }} -j RETURN
{% endfor %}
-A FORWARD -j DROP

COMMIT

